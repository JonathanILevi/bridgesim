<link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>

<link rel="import" href="../bower_components/carbon-route/carbon-location.html">
<link rel="import" href="../bower_components/carbon-route/carbon-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-location/iron-location.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="./deps.html">
<link rel="import" href="./input.html">
<link rel="import" href="./chat.html">
<link rel="import" href="./settings-menu.html">
<link rel="import" href="./lobby.html">
<link rel="import" href="./peer-localstorage.html">
<link rel="import" href="./peer-copypaste.html">

<link rel="import" href="./stations/comms.html">
<link rel="import" href="./stations/engineering.html">
<link rel="import" href="./stations/helm.html">
<link rel="import" href="./stations/science.html">
<link rel="import" href="./stations/viewscreen.html">
<link rel="import" href="./stations/weapons.html">

<dom-module id="bridgesim-game">
  <template>
    <iron-location query="{{urlQuery}}"></iron-location>

    <bridgesim-peer-localstorage
      id="peerLocalstorage"
      is-host="[[isHost]]"
      on-connection="onConnection">
    </bridgesim-peer-localstorage>

    <bridgesim-peer-copypaste
      id="peerCopypaste"
      on-connection="onConnection">
    </bridgesim-peer-copypaste>

    <bridgesim-input id="input" ship="[[ship]]"></bridgesim-input>

    <style include="iron-flex iron-flex-alignment iron-flex-factors">
    </style>

    <style>
      :host {
        display: block;
        background-color: #000;
        color: #fff;

        --bridgesim-font: {
          font-family: 'Share Tech Mono';
        };
        @apply(--bridgesim-font);
        --paper-font-common-base: {
          @apply(--bridgesim-font);
        };
        --paper-button: {
          @apply(--bridgesim-font);
        }
        --paper-dialog: {
          @apply(--bridgesim-font);
        }
        --paper-input-container: {
          @apply(--bridgesim-font);
        }
        --paper-input-container-label: {
          @apply(--bridgesim-font);
        }
        --paper-input-suffix: {
          @apply(--bridgesim-font);
        }

        --paper-tab-ink: #7FDBFF;
        --paper-tabs-selection-bar-color: #7FDBFF;
      }
      [drawer] {
        color: black;
        background-color: #fff;
      }
      [drawer] > * {
        margin: 10px;
      }
      paper-toggle-button {
        cursor: pointer;
      }
      bridgesim-chat {
        margin: 0 !important;
        height: 98px;
      }
    </style>

    <paper-dialog id="settingsDialog">
      <bridgesim-settings-menu settings="{{settings}}">
      </bridgesim-settings-menu>
    </paper-dialog>

    <paper-dialog id="lobbyDialog">
      <bridgesim-lobby roster="[[roster]]"
                       on-join-crew="joinCrew"
                       on-create-ship="createShip">
      </bridgesim-lobby>
    </paper-dialog>

    <paper-drawer-panel force-narrow>
      <div drawer class="layout vertical center">
        <h1>BRIDGESIM</h1>

        <paper-button on-tap="openSettingsDialog">Settings</paper-button>
        <paper-button on-tap="openLobbyDialog">Lobby</paper-button>

        <paper-button disabled$="[[isHost]]" on-tap="joinGame">
          Join Game</paper-button>
        <paper-button disabled$="[[isClient]]" on-tap="invitePlayer">
          Invite Player</paper-button>

        <paper-toggle-button checked="{{isHost}}">HOST</paper-toggle-button>
      </div>

      <div main id="panels" class="layout vertical">
        <div class="layout horizontal center">
          <paper-icon-button icon="menu"
                             paper-drawer-toggle>
          </paper-icon-button>

          <paper-tabs selected="{{routeData.station}}"
                      attr-for-selected="name"
                      class="flex-2">
            <paper-tab name='helm'>Helm</paper-tab>
            <paper-tab name='comms'>Comms</paper-tab>
            <paper-tab name='science'>Science</paper-tab>
            <paper-tab name='weapons'>Weapons</paper-tab>
            <paper-tab name='engineering'>Engineering</paper-tab>
            <paper-tab name='viewscreen'>Viewscreen</paper-tab>
          </paper-tabs>
        </div>

        <bridgesim-chat id="chat" on-send-chat="sendChat"></bridgesim-chat>

        <iron-pages id='stations' selected="[[routeData.station]]" attr-for-selected='name'>
          <helm-station name='helm' ship="[[ship]]" ships="[[ships]]" size="[[size]]">
          </helm-station>
          <comms-station name='comms' ship="[[ship]]">
          </comms-station>
          <science-station name='science' ship="[[ship]]">
          </science-station>
          <weapons-station name='weapons' ship="[[ship]]">
          </weapons-station>
          <engineering-station name='engineering' ship="[[ship]]">
          </engineering-station>
          <viewscreen-station name='viewscreen' ship="[[ship]]" ships="[[ships]]" size="[[size]]">
          </viewscreen-station>
        </iron-pages>
      </div>
    </paper-drawer-panel>

    <carbon-location route="{{route}}" use-hash-as-path></carbon-location>
    <carbon-route route="{{route}}" pattern="/station/:station" data="{{routeData}}"></carbon-route>
  </template>

  <script src="game.js"></script>
</dom-module>
